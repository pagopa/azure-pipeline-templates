parameters:
  - name: 'NEXT_VERSION'
    type: string
    default: "none"
  - name: 'CURRENT_VERSION'
    type: string
    default: "none"
  - name: 'CURRENT_VERSION_BRANCH'
    type: string
    default: "none"
  - name: 'CURRENT_VERSION_TAG'
    type: string
    default: "none"
  - name: 'BUILD_ID'
    type: string
    default: "none"

steps:
  - task: Bash@3
    name: decision
    displayName: 'Decision'
    inputs:
      targetType: "inline"
      script: |
        echo "[INFO] Decision"
        echo "[INFO] next_version: ${{ parameters.NEXT_VERSION }}"
        echo "[INFO] current_version: ${{ parameters.CURRENT_VERSION }}"
        echo "[INFO] current_version_branch: ${{ parameters.CURRENT_VERSION_BRANCH }}"
        echo "[INFO] current_version_branch: ${{ parameters.CURRENT_VERSION_TAG }}"
        echo "[INFO] build_id: ${{ parameters.BUILD_ID }}"
        if [ ! -z "${{ parameters.NEXT_VERSION }}" ];
          version="${{ parameters.NEXT_VERSION }}"
          echo "##vso[task.setvariable variable=value;isOutput=true]$version"
          exit 0
        fi
        if [ ! -z "${{ parameters.CURRENT_VERSION_TAG }}" ];
          version="${{ parameters.CURRENT_VERSION_TAG }}"
          echo "##vso[task.setvariable variable=value;isOutput=true]$version"
          exit 0
        fi
        if [ ! -z "${{ parameters.CURRENT_VERSION }}" ];
          version="${{ parameters.CURRENT_VERSION }}-${{ parameters.BUILD_ID }}"
          echo "##vso[task.setvariable variable=value;isOutput=true]$version"
          exit 0
        fi
        if [ ! -z "${{ parameters.CURRENT_VERSION_BRANCH }}" ];
          version="${{ parameters.CURRENT_VERSION_BRANCH }}-${{ parameters.BUILD_ID }}"
          echo "##vso[task.setvariable variable=value;isOutput=true]$version"
          exit 0
        fi
        echo "[ERROR] All parameters are unset"
        exit 1
      failOnStderr: true
