# Azure DevOps pipeline template to upgrade yarn.lock file

parameters:

  - name: 'projectDir'
    type: string
    default: '.'

# ------------------
# Test parameters only


# ------------------
# Steps 

steps:

- bash: |

    yarn install
    lockfile_changed=`git ls-files -m | grep yarn.lock`

    echo "lockfile_changed => $lockfile_changed"
    if [ -n "$lockfile_changed" ]
    then
        title="[Yarn.lock update] Update yarn.lock file"
        description="Autogenerated PR for updating yarn.lock file"
        
        branch_name="lockfile-upgrade-$(date +%s)"
        
        git checkout -b "$branch_name"
        git add yarn.lock
        git commit -m "$title"
        git push origin "$branch_name"

        hub pull-request -m "$title" -m "$description" 
    fi
    
  workingDirectory: ${{ parameters.projectDir }}

  

