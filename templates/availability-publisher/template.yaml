# Track an availability event
parameters:
  - name: "CONDITION_FLAG"
    displayName: "(Optional) Run on conditions."
    type: string
    default: "succeeded()"
  - name: "APP_INSIGHT_CONNECTION_STRING"
    displayName: "(Required) Application insight connection string"
    type: string

steps:
  - checkout: https://github.com/pagopa/azure-pipeline-templates.git
    path: availability-publisher

  - task: UseNode@1
    condition: '${{ parameters.CONDITION_FLAG }}'
    inputs:
      version: '23.x'
    displayName: 'Install Node.js'

  - task: Bash@3
    inputs:
      targetType: inline
      workingDirectory: availability-publisher/availability-publisher
      script: |
        #!/bin/bash
        node availability-publisher.js
    env:
      APP_INSIGHT_CONNECTION_STRING: ${{ parameters.APP_INSIGHT_CONNECTION_STRING }}
